# é˜¿é‡Œå·´å·´å…­è¾¹å½¢æ¶æ„-ä»è§£è€¦åˆ°å¯æµ‹è¯•çš„æ¶æ„è®¾è®¡åˆ©å™¨

æ‘˜è¦ï¼šå¦‚ä½•æ„å»ºçµæ´»å¯æµ‹è¯•çš„ç³»ç»Ÿæ¶æ„ï¼Ÿå…­è¾¹å½¢æ¶æ„ï¼ˆHexagonal Architectureï¼‰é€šè¿‡ç«¯å£ä¸é€‚é…å™¨æ¨¡å¼ï¼Œå°†æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ä¸å¤–éƒ¨æ¥å£è§£è€¦ã€‚è§£ææ ¸å¿ƒæ€æƒ³ä¸å®è·µæ–¹æ³•ï¼ŒåŠ©ä½ æ„å»ºé«˜å†…èšä½è€¦åˆçš„ä¼ä¸šçº§ç³»ç»Ÿã€‚

---

## å…­è¾¹å½¢æ¶æ„ï¼ˆHexagonal Architectureï¼‰æ˜¯ä»€ä¹ˆ

**ç”Ÿæ´»åŒ–æ¯”å–»**ï¼šæƒ³è±¡ä½ çš„æˆ¿å­ï¼ˆæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼‰æœ‰å¤šä¸ªé—¨ï¼ˆç«¯å£ Portsï¼‰ï¼Œæ¯ä¸ªé—¨å¤–é¢éƒ½æœ‰ä¸åŒçš„é€šé“ï¼ˆé€‚é…å™¨ Adaptersï¼‰è¿æ¥å¤–ç•Œã€‚æ— è®ºæ˜¯å¿«é€’å‘˜ï¼ˆAPI æ¥å£ï¼‰ã€æ°´ç®¡å·¥ï¼ˆæ•°æ®åº“ï¼‰ã€è¿˜æ˜¯é‚»å±…ï¼ˆç¬¬ä¸‰æ–¹æœåŠ¡ï¼‰ï¼Œéƒ½å¿…é¡»é€šè¿‡è¿™äº›é€šé“è¿›å…¥ä½ çš„æˆ¿å­ï¼Œè€Œä½ çš„æˆ¿å­å†…éƒ¨ç»“æ„ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰å®Œå…¨ä¸å—å¤–éƒ¨å½±å“ã€‚

- **ä¸“ä¸šå®šä¹‰**ï¼šå…­è¾¹å½¢æ¶æ„ï¼Œåˆç§°**ç«¯å£ä¸é€‚é…å™¨æ¶æ„ï¼ˆPorts and Adapters Architectureï¼‰**ï¼Œç”± Alistair Cockburn äº 2005 å¹´æå‡ºã€‚å®ƒå°†åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ä¸å¤–éƒ¨æ¥å£ï¼ˆç”¨æˆ·ç•Œé¢ã€æ•°æ®åº“ã€ç¬¬ä¸‰æ–¹æœåŠ¡ç­‰ï¼‰è§£è€¦ï¼Œå½¢æˆæ¸…æ™°çš„åˆ†å±‚ç»“æ„ã€‚
- **æ ¸å¿ƒä»·å€¼**ï¼šè®©æ ¸å¿ƒä¸šåŠ¡é€»è¾‘**ç‹¬ç«‹äºæŠ€æœ¯ç»†èŠ‚**ï¼Œæé«˜ç³»ç»Ÿçš„å¯æµ‹è¯•æ€§ã€å¯ç»´æŠ¤æ€§å’Œçµæ´»æ€§ã€‚

---

## ä¸ºä»€ä¹ˆå¤§å‹äº’è”ç½‘å…¬å¸éœ€è¦å…­è¾¹å½¢æ¶æ„

å¤§å‹äº’è”ç½‘å…¬å¸ï¼ˆå¦‚é˜¿é‡Œå·´å·´ã€è…¾è®¯ã€å­—èŠ‚è·³åŠ¨ï¼‰é¢ä¸´çš„æ ¸å¿ƒæŒ‘æˆ˜ï¼š

### 1. ä¸šåŠ¡å¤æ‚åº¦é«˜

- **ä¸šåŠ¡åŸŸä¼—å¤š**ï¼šç”µå•†ã€æ”¯ä»˜ã€ç‰©æµã€äº‘è®¡ç®—ã€æ–‡å¨±ç­‰å¤šä¸ªä¸šåŠ¡åŸŸ
- **ä¸šåŠ¡è§„åˆ™é¢‘ç¹å˜åŒ–**ï¼šä¿ƒé”€æ´»åŠ¨ã€é£æ§è§„åˆ™ã€ä¸šåŠ¡ç­–ç•¥ä¸æ–­è°ƒæ•´
- **è·¨ç³»ç»Ÿé›†æˆ**ï¼šéœ€è¦ä¸æ•°ç™¾ä¸ªå¤–éƒ¨ç³»ç»Ÿé›†æˆ

### 2. æŠ€æœ¯æ ˆå¤šæ ·åŒ–

- **æ•°æ®åº“**ï¼šMySQLã€PostgreSQLã€MongoDBã€Redis ç­‰å¤šç§å­˜å‚¨
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šRabbitMQã€Kafkaã€RocketMQ ç­‰ä¸åŒä¸­é—´ä»¶
- **ç¬¬ä¸‰æ–¹æœåŠ¡**ï¼šæ”¯ä»˜ç½‘å…³ã€ç‰©æµ APIã€çŸ­ä¿¡æœåŠ¡ç­‰

### 3. ç³»ç»Ÿæ¼”è¿›éœ€æ±‚

- **å¿«é€Ÿè¿­ä»£**ï¼šä¸šåŠ¡éœ€æ±‚å¿«é€Ÿå˜åŒ–ï¼Œéœ€è¦å¿«é€Ÿå“åº”
- **æŠ€æœ¯å‡çº§**ï¼šæ•°æ®åº“è¿ç§»ã€æ¡†æ¶å‡çº§ä¸èƒ½å½±å“ä¸šåŠ¡é€»è¾‘
- **ç³»ç»Ÿæ‰©å±•**ï¼šæ–°å¢åŠŸèƒ½ä¸èƒ½ç ´åç°æœ‰ç³»ç»Ÿç¨³å®šæ€§

**å…­è¾¹å½¢æ¶æ„çš„ä»·å€¼**ï¼šé€šè¿‡**è§£è€¦æ ¸å¿ƒé€»è¾‘ä¸å¤–éƒ¨æ¥å£**ï¼Œè®©ç³»ç»Ÿåƒ"å¯æ’æ‹”"çš„ç»„ä»¶ï¼Œè½»æ¾åº”å¯¹ä¸šåŠ¡å˜åŒ–å’ŒæŠ€æœ¯æ¼”è¿›ã€‚

---

## å…­è¾¹å½¢æ¶æ„æ ¸å¿ƒæ¦‚å¿µ

### 1. æ ¸å¿ƒåŸŸï¼ˆCore Domainï¼‰

**å®šä¹‰**ï¼šåº”ç”¨ç¨‹åºçš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ŒåŒ…å«ä¸šåŠ¡è§„åˆ™å’Œé¢†åŸŸæ¨¡å‹ï¼ˆDomain Modelï¼‰ã€‚

**ç‰¹ç‚¹**ï¼š
- **æ— ä¾èµ–**ï¼šä¸ä¾èµ–ä»»ä½•å¤–éƒ¨æ¡†æ¶ã€æ•°æ®åº“ã€UI ç­‰æŠ€æœ¯ç»†èŠ‚
- **çº¯ä¸šåŠ¡é€»è¾‘**ï¼šåªå…³æ³¨"åšä»€ä¹ˆ"ï¼ˆWhatï¼‰ï¼Œä¸å…³å¿ƒ"æ€ä¹ˆåš"ï¼ˆHowï¼‰
- **å¯æµ‹è¯•**ï¼šå¯ä»¥åœ¨æ²¡æœ‰æ•°æ®åº“ã€ç½‘ç»œè¿æ¥çš„æƒ…å†µä¸‹è¿›è¡Œå•å…ƒæµ‹è¯•

**ç¤ºä¾‹**ï¼šç”µå•†ç³»ç»Ÿä¸­çš„"è®¢å•å¤„ç†"ã€"åº“å­˜ç®¡ç†"ã€"ä»·æ ¼è®¡ç®—"ç­‰æ ¸å¿ƒä¸šåŠ¡è§„åˆ™ã€‚

### 2. ç«¯å£ï¼ˆPortsï¼‰

**å®šä¹‰**ï¼šå®šä¹‰æ ¸å¿ƒåŸŸä¸å¤–éƒ¨ä¸–ç•Œäº¤äº’çš„**æ¥å£ï¼ˆInterfaceï¼‰**ï¼Œæè¿°è¾“å…¥å’Œè¾“å‡ºçš„æ–¹å¼ã€‚

**ç±»å‹**ï¼š
- **è¾“å…¥ç«¯å£ï¼ˆInput Portsï¼‰**ï¼šé©±åŠ¨ç«¯å£ï¼ˆDriving Portsï¼‰ï¼Œæ¥æ”¶å¤–éƒ¨è¯·æ±‚
  - ä¾‹å¦‚ï¼šç”¨æˆ·æœåŠ¡æ¥å£ï¼ˆUserServiceï¼‰ã€è®¢å•æœåŠ¡æ¥å£ï¼ˆOrderServiceï¼‰
- **è¾“å‡ºç«¯å£ï¼ˆOutput Portsï¼‰**ï¼šè¢«é©±åŠ¨ç«¯å£ï¼ˆDriven Portsï¼‰ï¼Œå‘å¤–éƒ¨å‘é€è¯·æ±‚
  - ä¾‹å¦‚ï¼šä»“å‚¨æ¥å£ï¼ˆRepositoryï¼‰ã€æ¶ˆæ¯å‘é€æ¥å£ï¼ˆMessageSenderï¼‰

**ç‰¹ç‚¹**ï¼š
- **æŠ½è±¡æ¥å£**ï¼šåªå®šä¹‰æ–¹æ³•ç­¾åï¼Œä¸åŒ…å«å…·ä½“å®ç°
- **ä¸šåŠ¡å¯¼å‘**ï¼šæ¥å£è®¾è®¡åŸºäºä¸šåŠ¡éœ€æ±‚ï¼Œè€ŒéæŠ€æœ¯å®ç°
- **ç¨³å®šä¸å˜**ï¼šæ¥å£å®šä¹‰ç¨³å®šï¼Œä¸ä¼šå› ä¸ºæŠ€æœ¯å˜åŒ–è€Œæ”¹å˜

### 3. é€‚é…å™¨ï¼ˆAdaptersï¼‰

**å®šä¹‰**ï¼šå®ç°ç«¯å£æ¥å£çš„**å…·ä½“æŠ€æœ¯å®ç°**ï¼Œå°†å¤–éƒ¨è¯·æ±‚è½¬æ¢ä¸ºæ ¸å¿ƒé€»è¾‘å¯å¤„ç†çš„å½¢å¼ã€‚

**ç±»å‹**ï¼š
- **è¾“å…¥é€‚é…å™¨ï¼ˆInput Adaptersï¼‰**ï¼šå®ç°è¾“å…¥ç«¯å£ï¼Œæ¥æ”¶å¤–éƒ¨è¯·æ±‚
  - ä¾‹å¦‚ï¼šREST API æ§åˆ¶å™¨ï¼ˆREST Controllerï¼‰ã€æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆè´¹è€…ï¼ˆMQ Consumerï¼‰ã€WebSocket å¤„ç†å™¨
- **è¾“å‡ºé€‚é…å™¨ï¼ˆOutput Adaptersï¼‰**ï¼šå®ç°è¾“å‡ºç«¯å£ï¼Œè¿æ¥å¤–éƒ¨ç³»ç»Ÿ
  - ä¾‹å¦‚ï¼šMySQL ä»“å‚¨å®ç°ï¼ˆMySQL Repositoryï¼‰ã€Redis ç¼“å­˜å®ç°ï¼ˆRedis Cacheï¼‰ã€ç¬¬ä¸‰æ–¹æ”¯ä»˜æœåŠ¡è°ƒç”¨

**ç‰¹ç‚¹**ï¼š
- **æŠ€æœ¯å®ç°**ï¼šåŒ…å«å…·ä½“çš„æŠ€æœ¯ç»†èŠ‚ï¼ˆæ¡†æ¶ã€æ•°æ®åº“ã€åè®®ç­‰ï¼‰
- **å¯æ›¿æ¢**ï¼šå¯ä»¥è½»æ¾æ›¿æ¢ä¸åŒçš„é€‚é…å™¨å®ç°ï¼Œä¸å½±å“æ ¸å¿ƒé€»è¾‘
- **å•å‘ä¾èµ–**ï¼šé€‚é…å™¨ä¾èµ–æ ¸å¿ƒåŸŸï¼Œæ ¸å¿ƒåŸŸä¸ä¾èµ–é€‚é…å™¨

---

## å…­è¾¹å½¢æ¶æ„ç»“æ„å›¾ï¼ˆMermaidï¼‰

```mermaid
graph TB
    subgraph å¤–éƒ¨ä¸–ç•Œ
        A[Web å‰ç«¯]
        B[ç§»åŠ¨ App]
        C[REST API]
        D[æ¶ˆæ¯é˜Ÿåˆ—]
    end
    
    subgraph è¾“å…¥é€‚é…å™¨
        E[REST Controller]
        F[Message Consumer]
    end
    
    subgraph æ ¸å¿ƒåŸŸ
        G[ä¸šåŠ¡é€»è¾‘<br/>Business Logic]
        H[é¢†åŸŸæ¨¡å‹<br/>Domain Model]
    end
    
    subgraph ç«¯å£
        I[è¾“å…¥ç«¯å£<br/>Input Ports]
        J[è¾“å‡ºç«¯å£<br/>Output Ports]
    end
    
    subgraph è¾“å‡ºé€‚é…å™¨
        K[MySQL Repository]
        L[Redis Cache]
        M[ç¬¬ä¸‰æ–¹æœåŠ¡è°ƒç”¨]
    end
    
    subgraph å¤–éƒ¨ç³»ç»Ÿ
        N[MySQL æ•°æ®åº“]
        O[Redis ç¼“å­˜]
        P[æ”¯ä»˜ç½‘å…³]
    end
    
    A --> E
    B --> E
    C --> E
    D --> F
    
    E --> I
    F --> I
    I --> G
    G --> H
    G --> J
    J --> K
    J --> L
    J --> M
    
    K --> N
    L --> O
    M --> P
    
    style G fill:#e8f5e9
    style H fill:#e8f5e9
    style I fill:#fff3e0
    style J fill:#fff3e0
    style E fill:#e1f5fe
    style F fill:#e1f5fe
    style K fill:#f3e5f5
    style L fill:#f3e5f5
    style M fill:#f3e5f5
```

**å›¾ä¾‹è¯´æ˜**ï¼š
- **ç»¿è‰²**ï¼šæ ¸å¿ƒåŸŸï¼ˆä¸šåŠ¡é€»è¾‘å’Œé¢†åŸŸæ¨¡å‹ï¼‰
- **æ©™è‰²**ï¼šç«¯å£ï¼ˆæ¥å£å®šä¹‰ï¼‰
- **è“è‰²**ï¼šè¾“å…¥é€‚é…å™¨ï¼ˆæ¥æ”¶å¤–éƒ¨è¯·æ±‚ï¼‰
- **ç´«è‰²**ï¼šè¾“å‡ºé€‚é…å™¨ï¼ˆè¿æ¥å¤–éƒ¨ç³»ç»Ÿï¼‰

---

## å…­è¾¹å½¢æ¶æ„ vs ä¼ ç»Ÿåˆ†å±‚æ¶æ„

### ä¼ ç»Ÿåˆ†å±‚æ¶æ„çš„é—®é¢˜

**æ¶æ„ç‰¹ç‚¹**ï¼š
```
è¡¨ç°å±‚ï¼ˆPresentation Layerï¼‰
    â†“ ä¾èµ–
ä¸šåŠ¡å±‚ï¼ˆBusiness Layerï¼‰
    â†“ ä¾èµ–
æ•°æ®è®¿é—®å±‚ï¼ˆData Access Layerï¼‰
    â†“ ä¾èµ–
æ•°æ®åº“ï¼ˆDatabaseï¼‰
```

**é—®é¢˜**ï¼š
1. **æŠ€æœ¯ä¾èµ–**ï¼šä¸šåŠ¡å±‚ä¾èµ–æ•°æ®è®¿é—®å±‚ï¼Œæ— æ³•ç‹¬ç«‹æµ‹è¯•
2. **éš¾ä»¥æ›¿æ¢**ï¼šæ›´æ¢æ•°æ®åº“éœ€è¦ä¿®æ”¹æ•´ä¸ªæ•°æ®è®¿é—®å±‚
3. **è€¦åˆåº¦é«˜**ï¼šä¸Šå±‚ä¾èµ–ä¸‹å±‚ï¼Œå½¢æˆç´§å¯†è€¦åˆ

### å…­è¾¹å½¢æ¶æ„çš„ä¼˜åŠ¿

**æ¶æ„ç‰¹ç‚¹**ï¼š
```
å¤–éƒ¨ç³»ç»Ÿ â†â†’ é€‚é…å™¨ â†â†’ ç«¯å£ â†â†’ æ ¸å¿ƒåŸŸ â†â†’ ç«¯å£ â†â†’ é€‚é…å™¨ â†â†’ å¤–éƒ¨ç³»ç»Ÿ
```

**ä¼˜åŠ¿**ï¼š
1. **æ ¸å¿ƒç‹¬ç«‹**ï¼šæ ¸å¿ƒåŸŸä¸ä¾èµ–ä»»ä½•å¤–éƒ¨ç³»ç»Ÿï¼Œå¯ä»¥ç‹¬ç«‹æµ‹è¯•
2. **æ˜“äºæ›¿æ¢**ï¼šæ›´æ¢æ•°æ®åº“åªéœ€æ›¿æ¢è¾“å‡ºé€‚é…å™¨ï¼Œä¸å½±å“æ ¸å¿ƒé€»è¾‘
3. **ä½è€¦åˆ**ï¼šé€šè¿‡ç«¯å£æ¥å£è§£è€¦ï¼Œä¾èµ–æ–¹å‘ç”±å¤–å‘å†…ï¼ˆä¾èµ–å€’ç½®åŸåˆ™ï¼‰

### å¯¹æ¯”ç¤ºä¾‹

**åœºæ™¯**ï¼šç”µå•†è®¢å•ç³»ç»Ÿéœ€è¦ä» MySQL è¿ç§»åˆ° PostgreSQLã€‚

| å¯¹æ¯”é¡¹ | ä¼ ç»Ÿåˆ†å±‚æ¶æ„ | å…­è¾¹å½¢æ¶æ„ |
|--------|------------|-----------|
| **æ ¸å¿ƒé€»è¾‘ä¿®æ”¹** | éœ€è¦ä¿®æ”¹ | æ— éœ€ä¿®æ”¹ |
| **æµ‹è¯•å½±å“** | éœ€è¦é‡æ–°æµ‹è¯•æ•´ä¸ªç³»ç»Ÿ | åªéœ€æµ‹è¯•æ–°çš„é€‚é…å™¨ |
| **è¿ç§»æˆæœ¬** | é«˜ï¼ˆå½±å“å¤šä¸ªå±‚æ¬¡ï¼‰ | ä½ï¼ˆåªå½±å“é€‚é…å™¨å±‚ï¼‰ |
| **é£é™©** | é«˜ï¼ˆå¯èƒ½ç ´åä¸šåŠ¡é€»è¾‘ï¼‰ | ä½ï¼ˆæ ¸å¿ƒé€»è¾‘ä¸å˜ï¼‰ |

---

## å…­è¾¹å½¢æ¶æ„å®ç°ç¤ºä¾‹

### Java ç¤ºä¾‹ï¼šè®¢å•å¤„ç†ç³»ç»Ÿ

**æ ¸å¿ƒåŸŸï¼šè®¢å•é¢†åŸŸæ¨¡å‹**

```java
// æ ¸å¿ƒåŸŸï¼šè®¢å•å®ä½“ï¼ˆæ— å¤–éƒ¨ä¾èµ–ï¼‰
public class Order {
    private String orderId;
    private String userId;
    private BigDecimal amount;
    private OrderStatus status;
    
    // ä¸šåŠ¡é€»è¾‘ï¼šè®¡ç®—è®¢å•æ€»ä»·
    public BigDecimal calculateTotal() {
        // çº¯ä¸šåŠ¡é€»è¾‘ï¼Œä¸ä¾èµ–å¤–éƒ¨ç³»ç»Ÿ
        return amount;
    }
    
    // ä¸šåŠ¡é€»è¾‘ï¼šç¡®è®¤è®¢å•
    public void confirm() {
        if (status != OrderStatus.PENDING) {
            throw new IllegalStateException("è®¢å•çŠ¶æ€ä¸æ­£ç¡®");
        }
        this.status = OrderStatus.CONFIRMED;
    }
}

// è¾“å‡ºç«¯å£ï¼šè®¢å•ä»“å‚¨æ¥å£ï¼ˆå®šä¹‰åœ¨æ ¸å¿ƒåŸŸï¼Œå®ç°åœ¨é€‚é…å™¨ï¼‰
public interface OrderRepository {
    void save(Order order);
    Order findById(String orderId);
    List<Order> findByUserId(String userId);
}

// è¾“å…¥ç«¯å£ï¼šè®¢å•æœåŠ¡æ¥å£
public interface OrderService {
    String createOrder(String userId, BigDecimal amount);
    void confirmOrder(String orderId);
    Order getOrder(String orderId);
}
```

**æ ¸å¿ƒåŸŸï¼šè®¢å•æœåŠ¡å®ç°**

```java
// æ ¸å¿ƒåŸŸï¼šè®¢å•æœåŠ¡å®ç°ï¼ˆä¾èµ–ç«¯å£æ¥å£ï¼Œä¸ä¾èµ–å…·ä½“å®ç°ï¼‰
public class OrderServiceImpl implements OrderService {
    private final OrderRepository orderRepository; // ä¾èµ–æ¥å£ï¼Œä¸ä¾èµ–å…·ä½“å®ç°
    
    public OrderServiceImpl(OrderRepository orderRepository) {
        this.orderRepository = orderRepository;
    }
    
    @Override
    public String createOrder(String userId, BigDecimal amount) {
        // æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
        Order order = new Order(UUID.randomUUID().toString(), userId, amount);
        orderRepository.save(order); // è°ƒç”¨ç«¯å£æ¥å£
        return order.getOrderId();
    }
    
    @Override
    public void confirmOrder(String orderId) {
        Order order = orderRepository.findById(orderId);
        order.confirm(); // è°ƒç”¨ä¸šåŠ¡é€»è¾‘
        orderRepository.save(order);
    }
    
    @Override
    public Order getOrder(String orderId) {
        return orderRepository.findById(orderId);
    }
}
```

**è¾“å‡ºé€‚é…å™¨ï¼šMySQL ä»“å‚¨å®ç°**

```java
// è¾“å‡ºé€‚é…å™¨ï¼šMySQL ä»“å‚¨å®ç°ï¼ˆåŒ…å«æŠ€æœ¯ç»†èŠ‚ï¼‰
@Repository
public class MySQLOrderRepository implements OrderRepository {
    private final JdbcTemplate jdbcTemplate; // ä¾èµ– Spring JDBC
    
    @Autowired
    public MySQLOrderRepository(JdbcTemplate jdbcTemplate) {
        this.jdbcTemplate = jdbcTemplate;
    }
    
    @Override
    public void save(Order order) {
        // å…·ä½“çš„æŠ€æœ¯å®ç°ï¼šSQL è¯­å¥
        String sql = "INSERT INTO orders (order_id, user_id, amount, status) VALUES (?, ?, ?, ?)";
        jdbcTemplate.update(sql, order.getOrderId(), order.getUserId(), 
                           order.getAmount(), order.getStatus().name());
    }
    
    @Override
    public Order findById(String orderId) {
        String sql = "SELECT * FROM orders WHERE order_id = ?";
        return jdbcTemplate.queryForObject(sql, this::mapRowToOrder, orderId);
    }
    
    @Override
    public List<Order> findByUserId(String userId) {
        String sql = "SELECT * FROM orders WHERE user_id = ?";
        return jdbcTemplate.query(sql, this::mapRowToOrder, userId);
    }
    
    private Order mapRowToOrder(ResultSet rs, int rowNum) throws SQLException {
        // æ•°æ®æ˜ å°„é€»è¾‘
        return new Order(rs.getString("order_id"), 
                        rs.getString("user_id"),
                        rs.getBigDecimal("amount"),
                        OrderStatus.valueOf(rs.getString("status")));
    }
}
```

**è¾“å…¥é€‚é…å™¨ï¼šREST API æ§åˆ¶å™¨**

```java
// è¾“å…¥é€‚é…å™¨ï¼šREST API æ§åˆ¶å™¨ï¼ˆæ¥æ”¶å¤–éƒ¨ HTTP è¯·æ±‚ï¼‰
@RestController
@RequestMapping("/api/orders")
public class OrderController {
    private final OrderService orderService; // ä¾èµ–ç«¯å£æ¥å£
    
    @Autowired
    public OrderController(OrderService orderService) {
        this.orderService = orderService;
    }
    
    @PostMapping
    public ResponseEntity<OrderResponse> createOrder(@RequestBody CreateOrderRequest request) {
        // å°† HTTP è¯·æ±‚è½¬æ¢ä¸ºä¸šåŠ¡è°ƒç”¨
        String orderId = orderService.createOrder(request.getUserId(), request.getAmount());
        return ResponseEntity.ok(new OrderResponse(orderId));
    }
    
    @PutMapping("/{orderId}/confirm")
    public ResponseEntity<Void> confirmOrder(@PathVariable String orderId) {
        orderService.confirmOrder(orderId);
        return ResponseEntity.ok().build();
    }
    
    @GetMapping("/{orderId}")
    public ResponseEntity<Order> getOrder(@PathVariable String orderId) {
        Order order = orderService.getOrder(orderId);
        return ResponseEntity.ok(order);
    }
}
```

**å…³é”®ç‚¹è¯´æ˜**ï¼š
- **æ ¸å¿ƒåŸŸï¼ˆOrderã€OrderServiceï¼‰**ï¼šçº¯ Java ç±»ï¼Œæ— æ¡†æ¶ä¾èµ–ï¼Œå¯ä»¥ç‹¬ç«‹æµ‹è¯•
- **ç«¯å£ï¼ˆOrderRepositoryã€OrderService æ¥å£ï¼‰**ï¼šå®šä¹‰åœ¨æ ¸å¿ƒåŸŸï¼Œæè¿°ä¸šåŠ¡éœ€æ±‚
- **é€‚é…å™¨ï¼ˆMySQLOrderRepositoryã€OrderControllerï¼‰**ï¼šåŒ…å«æŠ€æœ¯ç»†èŠ‚ï¼Œå®ç°ç«¯å£æ¥å£

---

## å…­è¾¹å½¢æ¶æ„æœ€ä½³å®è·µ

### 1. ä¾èµ–æ–¹å‘ï¼šä»å¤–å‘å†…

<p align="right"><span style="background:#e53935;color:#fff;padding:2px 6px;border-radius:4px">ğŸ”¥ Mustï¼ˆå¿…åšå®è·µï¼‰</span></p>

**åŸåˆ™**ï¼šé€‚é…å™¨ä¾èµ–æ ¸å¿ƒåŸŸï¼Œæ ¸å¿ƒåŸŸä¸ä¾èµ–é€‚é…å™¨ã€‚

**æ­£ç¡®ç¤ºä¾‹**ï¼š
```java
// âœ… æ­£ç¡®ï¼šé€‚é…å™¨ä¾èµ–æ ¸å¿ƒåŸŸçš„æ¥å£
public class MySQLOrderRepository implements OrderRepository { ... }
public class OrderController {
    private final OrderService orderService; // ä¾èµ–æ¥å£
}
```

**é”™è¯¯ç¤ºä¾‹**ï¼š
```java
// âŒ é”™è¯¯ï¼šæ ¸å¿ƒåŸŸä¾èµ–é€‚é…å™¨
public class OrderService {
    private MySQLOrderRepository repository; // ä¾èµ–å…·ä½“å®ç°
}
```

### 2. ç«¯å£è®¾è®¡ï¼šä¸šåŠ¡å¯¼å‘

<p align="right"><span style="background:#fb8c00;color:#fff;padding:2px 6px;border-radius:4px">â­ Shouldï¼ˆå»ºè®®å®è·µï¼‰</span></p>

**åŸåˆ™**ï¼šç«¯å£æ¥å£åŸºäºä¸šåŠ¡éœ€æ±‚è®¾è®¡ï¼Œè€ŒéæŠ€æœ¯å®ç°ã€‚

**æ­£ç¡®ç¤ºä¾‹**ï¼š
```java
// âœ… æ­£ç¡®ï¼šä¸šåŠ¡å¯¼å‘çš„æ¥å£
public interface OrderRepository {
    void save(Order order);           // ä¸šåŠ¡è¯­è¨€ï¼šä¿å­˜è®¢å•
    Order findById(String orderId);   // ä¸šåŠ¡è¯­è¨€ï¼šæ ¹æ® ID æŸ¥æ‰¾è®¢å•
}
```

**é”™è¯¯ç¤ºä¾‹**ï¼š
```java
// âŒ é”™è¯¯ï¼šæŠ€æœ¯å¯¼å‘çš„æ¥å£
public interface OrderRepository {
    void insert(String sql);          // æŠ€æœ¯è¯­è¨€ï¼šSQL æ’å…¥
    ResultSet query(String sql);      // æŠ€æœ¯è¯­è¨€ï¼šSQL æŸ¥è¯¢
}
```

### 3. é€‚é…å™¨éš”ç¦»ï¼šä¸€ä¸ªé€‚é…å™¨ä¸€ç§æŠ€æœ¯

<p align="right"><span style="background:#fb8c00;color:#fff;padding:2px 6px;border-radius:4px">â­ Shouldï¼ˆå»ºè®®å®è·µï¼‰</span></p>

**åŸåˆ™**ï¼šæ¯ç§æŠ€æœ¯å®ç°ä¸€ä¸ªç‹¬ç«‹çš„é€‚é…å™¨ï¼Œä¾¿äºæ›¿æ¢å’Œæµ‹è¯•ã€‚

**ç¤ºä¾‹**ï¼š
```java
// MySQL é€‚é…å™¨
public class MySQLOrderRepository implements OrderRepository { ... }

// PostgreSQL é€‚é…å™¨
public class PostgreSQLOrderRepository implements OrderRepository { ... }

// MongoDB é€‚é…å™¨
public class MongoDBOrderRepository implements OrderRepository { ... }
```

**å¥½å¤„**ï¼šæ›´æ¢æ•°æ®åº“åªéœ€ä¿®æ”¹é…ç½®ï¼Œæ³¨å…¥ä¸åŒçš„é€‚é…å™¨å®ç°å³å¯ã€‚

### 4. æ ¸å¿ƒåŸŸæµ‹è¯•ï¼šMock é€‚é…å™¨

<p align="right"><span style="background:#e53935;color:#fff;padding:2px 6px;border-radius:4px">ğŸ”¥ Mustï¼ˆå¿…åšå®è·µï¼‰</span></p>

**åŸåˆ™**ï¼šæ ¸å¿ƒåŸŸæµ‹è¯•æ—¶ï¼Œä½¿ç”¨ Mock å¯¹è±¡æ›¿ä»£çœŸå®é€‚é…å™¨ã€‚

**ç¤ºä¾‹**ï¼š
```java
@Test
public void testCreateOrder() {
    // Mock ä»“å‚¨é€‚é…å™¨
    OrderRepository mockRepository = Mockito.mock(OrderRepository.class);
    
    // åˆ›å»ºæœåŠ¡ï¼ˆæ ¸å¿ƒåŸŸï¼‰
    OrderService orderService = new OrderServiceImpl(mockRepository);
    
    // æµ‹è¯•ä¸šåŠ¡é€»è¾‘ï¼ˆæ— éœ€æ•°æ®åº“ï¼‰
    String orderId = orderService.createOrder("user123", new BigDecimal("100.00"));
    
    // éªŒè¯ä¸šåŠ¡é€»è¾‘æ­£ç¡®
    assertNotNull(orderId);
    verify(mockRepository).save(any(Order.class));
}
```

---

## å…­è¾¹å½¢æ¶æ„åœ¨å¤§å‹äº’è”ç½‘å…¬å¸çš„åº”ç”¨åœºæ™¯

### åœºæ™¯ä¸€ï¼šå¤šæ•°æ®æºæ”¯æŒ

<p align="right"><span style="background:#fb8c00;color:#fff;padding:2px 6px;border-radius:4px">â­ Shouldï¼ˆå»ºè®®å®è·µï¼‰</span></p>

**éœ€æ±‚**ï¼šç³»ç»Ÿéœ€è¦åŒæ—¶æ”¯æŒ MySQLã€PostgreSQLã€MongoDB ç­‰å¤šç§æ•°æ®åº“ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
```java
// å®šä¹‰ç«¯å£
public interface UserRepository {
    User findById(String userId);
    void save(User user);
}

// å®ç°å¤šä¸ªé€‚é…å™¨
public class MySQLUserRepository implements UserRepository { ... }
public class PostgreSQLUserRepository implements UserRepository { ... }
public class MongoDBUserRepository implements UserRepository { ... }

// é€šè¿‡é…ç½®é€‰æ‹©é€‚é…å™¨
@Configuration
public class RepositoryConfig {
    @Bean
    public UserRepository userRepository(@Value("${db.type}") String dbType) {
        switch (dbType) {
            case "mysql": return new MySQLUserRepository();
            case "postgresql": return new PostgreSQLUserRepository();
            case "mongodb": return new MongoDBUserRepository();
            default: throw new IllegalArgumentException("Unsupported DB type");
        }
    }
}
```

**ä»·å€¼**ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ä¸å˜ï¼Œåªéœ€åˆ‡æ¢é€‚é…å™¨å³å¯æ”¯æŒä¸åŒæ•°æ®åº“ã€‚

### åœºæ™¯äºŒï¼šç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ

<p align="right"><span style="background:#fb8c00;color:#fff;padding:2px 6px;border-radius:4px">â­ Shouldï¼ˆå»ºè®®å®è·µï¼‰</span></p>

**éœ€æ±‚**ï¼šæ”¯ä»˜ç³»ç»Ÿéœ€è¦æ”¯æŒå¤šä¸ªæ”¯ä»˜ç½‘å…³ï¼ˆæ”¯ä»˜å®ã€å¾®ä¿¡æ”¯ä»˜ã€é“¶è”ï¼‰ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
```java
// å®šä¹‰ç«¯å£
public interface PaymentGateway {
    PaymentResult pay(PaymentRequest request);
    RefundResult refund(RefundRequest request);
}

// å®ç°å¤šä¸ªé€‚é…å™¨
public class AlipayAdapter implements PaymentGateway { ... }
public class WeChatPayAdapter implements PaymentGateway { ... }
public class UnionPayAdapter implements PaymentGateway { ... }

// æ ¸å¿ƒåŸŸä½¿ç”¨ç«¯å£æ¥å£
public class PaymentService {
    private final PaymentGateway paymentGateway; // ä¾èµ–æ¥å£
    
    public PaymentResult processPayment(PaymentRequest request) {
        // æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
        return paymentGateway.pay(request);
    }
}
```

**ä»·å€¼**ï¼šæ–°å¢æ”¯ä»˜æ¸ é“åªéœ€å®ç°æ–°çš„é€‚é…å™¨ï¼Œä¸å½±å“æ ¸å¿ƒæ”¯ä»˜é€»è¾‘ã€‚

### åœºæ™¯ä¸‰ï¼šå¤šç«¯æ¥å£æ”¯æŒ

<p align="right"><span style="background:#1e88e5;color:#fff;padding:2px 6px;border-radius:4px">ğŸ’¡ Couldï¼ˆå¯é€‰å®è·µï¼‰</span></p>

**éœ€æ±‚**ï¼šåŒä¸€ä¸šåŠ¡é€»è¾‘éœ€è¦æ”¯æŒ REST APIã€GraphQLã€gRPC ç­‰å¤šç§æ¥å£åè®®ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
```java
// æ ¸å¿ƒåŸŸï¼šç”¨æˆ·æœåŠ¡æ¥å£ï¼ˆç«¯å£ï¼‰
public interface UserService {
    User getUser(String userId);
    void updateUser(User user);
}

// è¾“å…¥é€‚é…å™¨ï¼šREST API
@RestController
public class UserRestController {
    private final UserService userService;
    // REST ç«¯ç‚¹å®ç°
}

// è¾“å…¥é€‚é…å™¨ï¼šGraphQL
@Controller
public class UserGraphQLController {
    private final UserService userService;
    // GraphQL è§£æå™¨å®ç°
}

// è¾“å…¥é€‚é…å™¨ï¼šgRPC
public class UserGrpcService extends UserServiceGrpc.UserServiceImplBase {
    private final UserService userService;
    // gRPC æœåŠ¡å®ç°
}
```

**ä»·å€¼**ï¼šä¸šåŠ¡é€»è¾‘å¤ç”¨ï¼Œä¸åŒæ¥å£åè®®åªéœ€å®ç°ä¸åŒçš„é€‚é…å™¨ã€‚

---

## å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### é—®é¢˜ä¸€ï¼šå¦‚ä½•ç¡®å®šå“ªäº›ä»£ç å±äºæ ¸å¿ƒåŸŸï¼Ÿ

**åˆ¤æ–­æ ‡å‡†**ï¼š
1. **ä¸šåŠ¡è§„åˆ™**ï¼šåŒ…å«ä¸šåŠ¡é€»è¾‘å’Œé¢†åŸŸçŸ¥è¯†
2. **æ— æŠ€æœ¯ä¾èµ–**ï¼šä¸ä¾èµ–ä»»ä½•æ¡†æ¶ã€æ•°æ®åº“ã€å¤–éƒ¨æœåŠ¡
3. **å¯ç‹¬ç«‹æµ‹è¯•**ï¼šå¯ä»¥åœ¨æ²¡æœ‰å¤–éƒ¨ä¾èµ–çš„æƒ…å†µä¸‹æµ‹è¯•

**ç¤ºä¾‹**ï¼š
- âœ… **æ ¸å¿ƒåŸŸ**ï¼šè®¢å•ç¡®è®¤é€»è¾‘ã€ä»·æ ¼è®¡ç®—ã€åº“å­˜æ£€æŸ¥
- âŒ **éæ ¸å¿ƒåŸŸ**ï¼šSQL æŸ¥è¯¢ã€HTTP è¯·æ±‚å¤„ç†ã€JSON åºåˆ—åŒ–

### é—®é¢˜äºŒï¼šç«¯å£æ¥å£å¦‚ä½•è®¾è®¡ï¼Ÿ

**è®¾è®¡åŸåˆ™**ï¼š
1. **ä¸šåŠ¡è¯­è¨€**ï¼šä½¿ç”¨ä¸šåŠ¡é¢†åŸŸçš„æœ¯è¯­ï¼ˆOrderã€Userï¼‰ï¼Œè€ŒéæŠ€æœ¯æœ¯è¯­ï¼ˆSQLã€HTTPï¼‰
2. **æœ€å°æ¥å£**ï¼šåªå®šä¹‰å¿…éœ€çš„æ¥å£ï¼Œé¿å…è¿‡åº¦è®¾è®¡
3. **ç¨³å®šä¸å˜**ï¼šæ¥å£å®šä¹‰ç¨³å®šï¼Œä¸ä¼šå› ä¸ºæŠ€æœ¯å˜åŒ–è€Œæ”¹å˜

**ç¤ºä¾‹**ï¼š
```java
// âœ… æ­£ç¡®ï¼šä¸šåŠ¡å¯¼å‘çš„æ¥å£
public interface OrderRepository {
    void save(Order order);
    Order findById(String orderId);
}

// âŒ é”™è¯¯ï¼šæŠ€æœ¯å¯¼å‘çš„æ¥å£
public interface OrderRepository {
    void executeSQL(String sql);
    ResultSet query(String sql);
}
```

### é—®é¢˜ä¸‰ï¼šé€‚é…å™¨æ˜¯å¦å¯ä»¥ä½¿ç”¨æ¡†æ¶ï¼Ÿ

**ç­”æ¡ˆ**ï¼šå¯ä»¥ï¼Œä½†éœ€è¦éš”ç¦»ã€‚

**åŸåˆ™**ï¼š
- **é€‚é…å™¨å±‚**ï¼šå¯ä»¥ä½¿ç”¨ Springã€MyBatisã€Hibernate ç­‰æ¡†æ¶
- **æ ¸å¿ƒåŸŸ**ï¼šä¸èƒ½ä¾èµ–ä»»ä½•æ¡†æ¶ï¼Œä¿æŒçº¯ Java ä»£ç 

**ç¤ºä¾‹**ï¼š
```java
// âœ… æ­£ç¡®ï¼šé€‚é…å™¨ä½¿ç”¨ Spring
@Repository
public class MySQLOrderRepository implements OrderRepository {
    @Autowired
    private JdbcTemplate jdbcTemplate; // Spring æ¡†æ¶
}

// âŒ é”™è¯¯ï¼šæ ¸å¿ƒåŸŸä½¿ç”¨ Spring
@Service  // ä¸åº”è¯¥åœ¨æ ¸å¿ƒåŸŸä½¿ç”¨ @Service
public class OrderServiceImpl implements OrderService {
    // ...
}
```

---

## å­¦ä¹ èµ„æºä¸å‚è€ƒèµ„æ–™

### å®˜æ–¹èµ„æº

- **Alistair Cockburn å®˜ç½‘**ï¼š[Hexagonal Architecture](https://alistair.cockburn.us/hexagonal-architecture/)
- **é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰**ï¼šå…­è¾¹å½¢æ¶æ„ä¸ DDD å¯†åˆ‡ç›¸å…³ï¼Œæ¨èå­¦ä¹  Eric Evans çš„ã€Šé¢†åŸŸé©±åŠ¨è®¾è®¡ã€‹

### ç¤¾åŒºèµ„æº

- **GitHub ç¤ºä¾‹é¡¹ç›®**ï¼šæœç´¢ "hexagonal-architecture" å¯ä»¥æ‰¾åˆ°å¤§é‡å¼€æºå®ç°ç¤ºä¾‹
- **æŠ€æœ¯åšå®¢**ï¼šInfoQã€ThoughtWorks ç­‰æŠ€æœ¯ç¤¾åŒºæœ‰ä¸°å¯Œçš„æ¶æ„è®¾è®¡æ–‡ç« 

### å‚è€ƒä¹¦ç±

- **ã€Šå®ç°é¢†åŸŸé©±åŠ¨è®¾è®¡ã€‹**ï¼šVaughn Vernon è‘—ï¼Œæ·±å…¥è®²è§£ DDD å’Œå…­è¾¹å½¢æ¶æ„
- **ã€Šæ¶æ„æ•´æ´ä¹‹é“ã€‹**ï¼šRobert C. Martin è‘—ï¼Œè®²è§£ä¾èµ–å€’ç½®å’Œæ¶æ„è®¾è®¡åŸåˆ™

---

## æ€»ç»“

å…­è¾¹å½¢æ¶æ„é€šè¿‡**ç«¯å£ä¸é€‚é…å™¨æ¨¡å¼**ï¼Œå°†æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ä¸å¤–éƒ¨æ¥å£è§£è€¦ï¼Œæ„å»ºå‡ºé«˜å†…èšã€ä½è€¦åˆçš„ç³»ç»Ÿæ¶æ„ã€‚å¯¹äºå¤§å‹äº’è”ç½‘å…¬å¸æ¥è¯´ï¼Œå…­è¾¹å½¢æ¶æ„ä¸ä»…æé«˜äº†ç³»ç»Ÿçš„**å¯æµ‹è¯•æ€§**å’Œ**å¯ç»´æŠ¤æ€§**ï¼Œæ›´é‡è¦çš„æ˜¯è®©ç³»ç»Ÿå…·å¤‡äº†**å¿«é€Ÿå“åº”ä¸šåŠ¡å˜åŒ–**å’Œ**æŠ€æœ¯æ¼”è¿›**çš„èƒ½åŠ›ã€‚

**æ ¸å¿ƒè¦ç‚¹å›é¡¾**ï¼š
- âœ… **æ ¸å¿ƒåŸŸç‹¬ç«‹**ï¼šä¸šåŠ¡é€»è¾‘ä¸ä¾èµ–ä»»ä½•å¤–éƒ¨ç³»ç»Ÿï¼Œå¯ç‹¬ç«‹æµ‹è¯•å’Œæ¼”è¿›
- âœ… **ç«¯å£å®šä¹‰æ¥å£**ï¼šé€šè¿‡æ¥å£æè¿°ä¸šåŠ¡éœ€æ±‚ï¼Œè€ŒéæŠ€æœ¯å®ç°
- âœ… **é€‚é…å™¨éš”ç¦»æŠ€æœ¯**ï¼šæŠ€æœ¯ç»†èŠ‚å°è£…åœ¨é€‚é…å™¨å±‚ï¼Œå¯ä»¥è½»æ¾æ›¿æ¢
- âœ… **ä¾èµ–ä»å¤–å‘å†…**ï¼šé€‚é…å™¨ä¾èµ–æ ¸å¿ƒåŸŸï¼Œæ ¸å¿ƒåŸŸä¸ä¾èµ–é€‚é…å™¨

**å®è·µå»ºè®®**ï¼š
1. **ä»æ ¸å¿ƒåŸŸå¼€å§‹**ï¼šå…ˆè¯†åˆ«æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œå†å®šä¹‰ç«¯å£æ¥å£
2. **æ¸è¿›å¼é‡æ„**ï¼šå¯ä»¥åœ¨ç°æœ‰ç³»ç»Ÿä¸­é€æ­¥å¼•å…¥å…­è¾¹å½¢æ¶æ„ï¼Œä¸éœ€è¦ä¸€æ¬¡æ€§é‡æ„
3. **æµ‹è¯•é©±åŠ¨**ï¼šé€šè¿‡ Mock é€‚é…å™¨æµ‹è¯•æ ¸å¿ƒåŸŸï¼Œç¡®ä¿ä¸šåŠ¡é€»è¾‘æ­£ç¡®æ€§
4. **å›¢é˜Ÿåä½œ**ï¼šæ˜ç¡®æ ¸å¿ƒåŸŸå’Œé€‚é…å™¨çš„è¾¹ç•Œï¼Œä¾¿äºå›¢é˜Ÿåˆ†å·¥å’Œåä½œ

**ç»§ç»­åŠ æ²¹ï¼Œæœªæ¥çš„æ¶æ„å¸ˆï¼** å…­è¾¹å½¢æ¶æ„ä¸ä»…æ˜¯æŠ€æœ¯æ–¹æ¡ˆï¼Œæ›´æ˜¯æ¶æ„æ€ç»´çš„ä½“ç°ã€‚æŒæ¡å®ƒï¼Œä½ å°±èƒ½æ„å»ºå‡ºæ—¢çµæ´»åˆå¯é çš„ä¼ä¸šçº§ç³»ç»Ÿï¼Œè®©æŠ€æœ¯åœ¨ä¸šåŠ¡å˜åŒ–ä¸­ä¿æŒç¨³å®šï¼Œåœ¨æŠ€æœ¯æ¼”è¿›ä¸­ä¿æŒé¢†å…ˆã€‚

---

å¦é—¨å·¥å­¦é™¢äººå·¥æ™ºèƒ½åˆ›ä½œåŠ -- éƒ‘æ©èµ  
2025 å¹´ 11 æœˆ 02 æ—¥

